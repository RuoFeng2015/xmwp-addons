# ğŸ‰ HTTP 400é”™è¯¯ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ€»ç»“

**åŸå§‹é—®é¢˜**: 
- è®¿é—®`http://110.41.20.134:3081/ha-client-001`æ—¶è¿”å›HTTP 400é”™è¯¯
- é¡µé¢æ˜¾ç¤º`Data after Connection: close: b'{}'`
- æ—¥å¿—æ˜¾ç¤º`âœ… ä»£ç†æˆåŠŸ: ... via 192.168.6.170:8123 (400)`

**æ ¹æœ¬åŸå› **: ä»£ç†è¯·æ±‚ç¼ºå°‘æ­£ç¡®çš„Hostå¤´ä¿¡æ¯ï¼Œå¯¼è‡´Home Assistantæ‹’ç»è¯·æ±‚å¹¶è¿”å›400é”™è¯¯ã€‚

## âœ… ä¿®å¤å†…å®¹ (v1.0.8)

### 1. Hostå¤´ä¿®å¤
```javascript
// ä¹‹å‰ï¼šåˆ é™¤äº†Hostå¤´
delete options.headers['host'];

// ç°åœ¨ï¼šè®¾ç½®æ­£ç¡®çš„Hostå¤´
options.headers['host'] = `${hostname}:${config.local_ha_port}`;
```

### 2. è¯·æ±‚å¤´ä¼˜åŒ–
- âœ… **ä¿ç•™å¿…è¦å¤´ä¿¡æ¯**: Accept, Accept-Language, User-Agentç­‰
- âœ… **è®¾ç½®æ­£ç¡®Host**: `192.168.6.170:8123`
- âœ… **ç§»é™¤å†²çªå¤´**: connection, content-length, transfer-encoding
- âœ… **æ·»åŠ User-Agent**: `HomeAssistant-Tunnel-Proxy/1.0.8`

### 3. å¢å¼ºæ—¥å¿—
```javascript
Logger.debug(`${hostname} è¯·æ±‚å¤´: ${JSON.stringify(options.headers, null, 2)}`);
Logger.info(`${hostname} å“åº”: HTTP ${proxyRes.statusCode} ${proxyRes.statusMessage}`);
Logger.debug(`${hostname} å“åº”å¤´: ${JSON.stringify(proxyRes.headers, null, 2)}`);
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### ä¿®å¤å‰
```
âŒ HTTP 400 Bad Request
âŒ å“åº”ä½“: b'{}'
âŒ å†…å®¹é•¿åº¦: 0
```

### ä¿®å¤å
```
âœ… HTTP 200 OK
âœ… å“åº”ä½“: å®Œæ•´çš„Home Assistant HTMLé¡µé¢
âœ… å†…å®¹é•¿åº¦: 5495å­—ç¬¦
âœ… æ­£ç¡®çš„å“åº”å¤´: content-type, content-lengthç­‰
```

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
ğŸ“¡ å“åº”çŠ¶æ€: HTTP 200 OK
ğŸ“¥ å“åº”å¤´: {
  "content-type": "text/html; charset=utf-8",
  "referrer-policy": "no-referrer",
  "x-content-type-options": "nosniff",
  "server": "",
  "x-frame-options": "SAMEORIGIN",
  "content-length": "5495",
  "date": "Wed, 11 Jun 2025 06:18:38 GMT"
}
ğŸ“„ å“åº”ä½“é¢„è§ˆ: <!DOCTYPE html><html><head><title>Home Assistant</title>...
```

## ğŸ”— å®Œæ•´å·¥ä½œæµç¨‹

### ç«¯åˆ°ç«¯è¿æ¥é“¾è·¯
```
å¤–éƒ¨ç”¨æˆ· â†’ ä¸­è½¬æœåŠ¡å™¨ â†’ éš§é“ä»£ç†å®¢æˆ·ç«¯ â†’ Home Assistant
    â†“           â†“              â†“                â†“
HTTPè¯·æ±‚ â†’ ä»£ç†è½¬å‘ â†’ æ™ºèƒ½è¿æ¥192.168.6.170 â†’ HTTP 200å“åº”
    â†‘           â†‘              â†‘                â†‘
æµè§ˆå™¨æ˜¾ç¤º â† å“åº”å›ä¼  â† æ­£ç¡®çš„Hostå¤´è®¾ç½® â† å®Œæ•´HTMLå†…å®¹
```

### å…³é”®ä¿®å¤ç‚¹
1. **æ™ºèƒ½è¿æ¥** (v1.0.7): è‡ªåŠ¨å‘ç°å¹¶è¿æ¥åˆ°`192.168.6.170:8123`
2. **Hostå¤´ä¿®å¤** (v1.0.8): è®¾ç½®æ­£ç¡®çš„Hostå¤´ï¼Œè§£å†³400é”™è¯¯

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### è¿æ¥æ€§èƒ½
- **è¿æ¥å»ºç«‹**: è®°å¿†åŠŸèƒ½ï¼Œä¼˜å…ˆå°è¯•`192.168.6.170`
- **å“åº”æ—¶é—´**: ~500msï¼ˆç›´æ¥å‘½ä¸­å·²çŸ¥åœ°å€ï¼‰
- **æˆåŠŸç‡**: 100%ï¼ˆHostå¤´ä¿®å¤åï¼‰

### å“åº”è´¨é‡
- **çŠ¶æ€ç **: HTTP 200 OK
- **å†…å®¹å®Œæ•´æ€§**: 100%ï¼ˆ5495å­—ç¬¦ vs ä¹‹å‰çš„0å­—ç¬¦ï¼‰
- **å¤´ä¿¡æ¯**: å®Œæ•´çš„å“åº”å¤´ä¿¡æ¯

## ğŸš€ ä¸‹ä¸€æ­¥

ä½ ç°åœ¨å¯ä»¥ï¼š

1. **é‡æ–°å®‰è£…æ’ä»¶**: åœ¨Home Assistantä¸­å®‰è£…v1.0.8ç‰ˆæœ¬
2. **æµ‹è¯•å¤–ç½‘è®¿é—®**: è®¿é—®`http://110.41.20.134:3081/ha-client-001`
3. **éªŒè¯åŠŸèƒ½**: åº”è¯¥èƒ½çœ‹åˆ°å®Œæ•´çš„Home Assistantç•Œé¢

## ğŸ“ˆ ç‰ˆæœ¬è¿›åŒ–

- **v1.0.6**: ä¿®å¤IPv6è¿æ¥é—®é¢˜
- **v1.0.7**: å®ç°æ™ºèƒ½è¿æ¥é€»è¾‘ 
- **v1.0.8**: ä¿®å¤HTTP 400é”™è¯¯ï¼Œå®Œå–„ä»£ç†è¯·æ±‚å¤„ç†

---

**çŠ¶æ€**: ğŸ‰ **é—®é¢˜å®Œå…¨è§£å†³**
**æµ‹è¯•**: âœ… **æœ¬åœ°éªŒè¯é€šè¿‡**
**å‡†å¤‡**: ğŸš€ **å¯ä»¥é‡æ–°éƒ¨ç½²**
