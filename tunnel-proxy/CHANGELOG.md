## [1.0.8] - 2025-06-11

### 🔧 关键修复
- **HTTP 400错误修复**: 修复代理请求返回400错误的问题
- **Host头处理**: 正确设置Host头信息，确保Home Assistant能识别请求
- **请求头优化**: 保留必要的请求头，只删除可能冲突的头信息
- **增强日志**: 添加详细的请求和响应头日志，便于调试

### ✅ 验证结果
- **测试通过**: 代理请求返回HTTP 200 OK
- **内容完整**: 成功获取Home Assistant完整页面（5495字符）
- **头信息正确**: Host头设置为`192.168.6.170:8123`

### 🛠️ 技术改进
- **超时调整**: 将连接超时时间调整到5秒
- **用户代理**: 设置明确的User-Agent标识
- **错误诊断**: 添加请求和响应头的详细日志

## [1.0.7] - 2025-06-11

### 🎯 智能连接优化
- **智能地址选择**: 优先尝试上次成功的HA地址，提高连接效率
- **扩展主机列表**: 支持更多可能的HA地址（127.0.0.1, localhost, 192.168.6.170, hassio.local等）
- **快速故障转移**: 减少连接超时时间到2秒，加快地址切换速度
- **连接记忆功能**: 自动记住成功的连接地址，下次优先使用

### 🔧 技术改进
- **代码重构**: 清理重复代码，统一智能连接逻辑
- **Buffer优化**: 使用Buffer处理响应体，防止数据损坏
- **错误处理**: 改进错误页面，提供更详细的诊断信息
- **状态监控**: 在连接状态中显示最后成功的主机地址

### 🐛 修复问题
- **网络连接**: 修复到192.168.6.170的智能连接问题
- **IPv4强制**: 确保所有连接都使用IPv4协议
- **响应完整性**: 修复响应体处理中的数据丢失问题

## [1.0.6] - 2025-06-11

### 🔧 重要修复
- **IPv6连接问题**: 修复 `connect ECONNREFUSED ::1:8123` 错误
- **强制IPv4**: 代理请求强制使用127.0.0.1而不是localhost
- **连接诊断**: 添加本地Home Assistant连接测试
- **错误信息优化**: 提供详细的错误诊断信息

### 🚀 新功能
- **自动连接测试**: 启动时自动测试本地HA连接
- **诊断工具**: 新增ha-diagnostic.js连接诊断脚本
- **友好错误页面**: 连接失败时显示详细的HTML错误页面

### 🛠️ 技术改进
- **IPv4优先**: 网络请求强制使用IPv4协议
- **详细日志**: 增强错误日志包含目标地址信息
- **连接稳定性**: 改善网络连接的稳定性和兼容性

## [1.0.5] - 2025-06-11

### 🚀 重大修复
- **代理功能实现**: 完整实现了HTTP代理转发逻辑，修复代理请求超时问题
- **请求处理**: 添加完整的本地Home Assistant请求转发功能
- **响应处理**: 实现代理响应回传机制
- **错误处理**: 添加代理请求错误和超时处理

### 🔧 技术改进
- **HTTP转发**: 使用Node.js原生http模块实现请求转发
- **头信息处理**: 正确处理HTTP头信息，避免冲突
- **超时控制**: 设置25秒代理请求超时，防止长时间等待
- **日志增强**: 添加详细的代理过程日志记录

### 🐛 修复问题
- **代理超时**: 修复"代理请求超时"错误
- **空响应**: 修复handleProxyRequest方法未实现的问题
- **连接问题**: 改善客户端与服务器通信稳定性

## [1.0.4] - 2025-06-11

### 🔧 修复
- **Docker构建问题**: 简化Dockerfile，移除可能导致构建失败的复杂npm配置
- **包管理优化**: 简化package.json，移除开发依赖项
- **安装稳定性**: 优化Docker层缓存，提高构建成功率
- **网络兼容性**: 使用更稳定的npm registry配置

### 🚀 改进
- **构建流程**: 分离package.json复制和npm install步骤，利用Docker缓存
- **错误处理**: 添加更好的构建错误恢复机制
- **兼容性**: 提升在不同网络环境下的安装成功率

## 1.0.1

### 新功能

- 🎉 初始版本发布
- ✨ 支持基于自建中转服务器的内网穿透
- ✨ HTTP 代理支持
- ✨ WebSocket 代理支持
- ✨ 用户名密码身份验证
- ✨ 支持最多10个并发用户
- ✨ 实时连接状态监控
- ✨ 详细日志记录

### 技术特性

- 🔧 基于 Node.js + Koa 框架
- 🔧 内存变量存储临时数据
- 🔧 模块化设计，便于维护
- 🔧 完善的错误处理机制
- 🔧 支持多架构（amd64、arm64等）

### 安全性

- 🔒 JWT token 身份验证
- 🔒 密码加密存储
- 🔒 安全的代理隧道
- 🔒 输入验证和过滤
